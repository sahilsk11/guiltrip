<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title id="title">guilt.rip</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link href="https://fonts.googleapis.com/css?family=Ubuntu:300,400,500,700&display=swap" rel="stylesheet">



    <link href="css/organize.css" rel="stylesheet">
    <link href="css/guilt.css" rel="stylesheet">
    <link href="images/favicon.png" rel="icon">

    <script>

        var index = 0;
        var price;
        var product;
        var elements = {
            "childrenFed": {
                "value": 0,
                "src": "images/feed.jpg",
                "string": "feed VAR WORD in war-stricken environments for one day",
                "singularWord": "child",
                "pluralWord": "children",
                "sourceName": "World Food Programme",
                "sourceUrl": "https://sharethemeal.org/en/index.html",
                "threshold": 1,
                "cost": 0.5,
                "donate": true
            },
            "africanSchool": {
                "value": 0,
                "src": "images/room.jpg",
                "string": "build VAR WORD in war-stricken environments",
                "singularWord": "school",
                "pluralWord": "schools",
                "percentString": "fund VAR of rebuilding a destroyed school",
                "sourceName": "The Illinois Review",
                "sourceUrl": "https://sharethemeal.org/en/index.html",
                "threshold": 0.01,
                "cost": 12000,
                "donate": true
            },
            "laptopStand": {
                "value": 0,
                "src": "images/mac.jpg",
                "string": "buy VAR Apple Mac WORD",
                "singularWord": "stand",
                "pluralWord": "stands",
                "percentString": "afford VAR of an Apple Mac stand",
                "sourceName": "Apple",
                "sourceUrl": "https://www.apple.com/pro-display-xdr/",
                "threshold": 0.01,
                "cost": 1000,
                "donate": false
            },
            "tesla": {
                "value": 0,
                "src": "images/model3.jpg",
                "string": "buy VAR Tesla WORD",
                "singularWord": "Model 3",
                "pluralWord": "Model 3's",
                "percentString": "buy VAR of a Tesla Model 3",
                "sourceName": "Tesla",
                "sourceUrl": "http://www.tesla.com/model3",
                "threshold": 0.01,
                "cost": 38000,
                "donate": false
            },
            "disneyTickets": {
                "value": 0,
                "src": "images/disney.jpg",
                "string": "buy VAR WORD to Disneyland",
                "singularWord": "ticket",
                "pluralWord": "tickets",
                "percentString": "buy VAR of a ticket to Disneyland",
                "sourceName": "Disney",
                "sourceUrl": "https://disneyland.disney.go.com/tickets/",
                "threshold": 1,
                "cost": 150,
                "donate": false
            },
            "girlsToSchool": {
                "value": 0,
                "src": "images/school.jpg",
                "string": "send VAR young girls in poverty to school for one year",
                "sourceName": "rescue.org",
                "sourceUrl": "https://gifts.rescue.org/product/education/year-school-two-girls",
                "threshold": 1,
                "cost": 58,
                "donate": true
            },
            "remoteClinic": {
                "value": 0,
                "src": "images/clinic.jpg",
                "string": "fund VAR health WORD in impoverished communities",
                "singularWord": "clinic",
                "pluralWord": "clinics",
                "percentString": "fund VAR of a health clinic in an impoverished community",
                "sourceName": "World Food Programme",
                "sourceUrl": "https://gifts.rescue.org/product/emergency-relief/mobile-medical-clinics",
                "threshold": 0.01,
                "cost": 500,
                "donate": true
            },
            "womensTraining": {
                "value": 0,
                "src": "images/business.jpg",
                "string": "train VAR WORD about running sustaining business",
                "singularWord": "woman in a rural community",
                "pluralWord": "women in rural communities",
                "sourceName": "World Food Programme",
                "sourceUrl": "https://gifts.rescue.org/product/rebuilding/womens-small-business-training",
                "threshold": 1,
                "cost": 200,
                "donate": true
            },
            "cleanWater": {
                "value": 0,
                "src": "images/water.jpg",
                "string": "build VAR clean water WORD",
                "singularWord": "system in a remote area",
                "pluralWord": "systems in remote areas",
                "percentString": "fund VAR of a clean water system in a remote area",
                "sourceName": "World Food Programme",
                "sourceUrl": "https://gifts.rescue.org/product/emergency-relief/clean-water",
                "threshold": 0.01,
                "cost": 110,
                "donate": true
            },
            "poundsOfTrash": {
                "value": 0,
                "src": "images/trash.jpeg",
                "string": "remove VAR WORD of trash from the ocean",
                "singularWord": "pound",
                "pluralWord": "pounds",
                "sourceName": "World Food Programme",
                "sourceUrl": "https://4ocean.com/",
                "threshold": 1,
                "cost": 20,
                "donate": true
            }
        }
        var keys = Object.keys(elements).sort(() => Math.random() - 0.5);

        function parseUrl() {
            var params = window.location.search;
            product = decodeURI(params.substring(9, params.indexOf("&")));
            price = params.substring(params.indexOf("$"));

            price = price.replace("$", "");
            if (checkCost()) {
                addProductElements(product, price);
                price = price.replace(",", "");
                calculateMoney();
            }
        }

        function addProductElements(product, price) {
            document.getElementById("product").innerHTML = product;
            document.getElementById("price").innerHTML = price;
        }

        function checkCost() {
            var found = false;
            var p = price;
            p = p.replace(",", "");
            for (var i = 0; i < keys.length; i++) {
                var e = keys[i];
                var value = p / elements[e]["cost"];
                if (value > elements[e]["threshold"]) {
                    found = true;
                    //alert();
                }
            }
            if (!found) {
                alert("We couldn't find anything in that price range. Try raising the price and try again");
                window.location.href = "index.html";
                return false
            }
            return true;
        }

        function calculateMoney(backward) {
            console.log(index);
            document.getElementById("element-image").src = "";
            var e = keys[index];
            var value = price / elements[e]["cost"];
            if (value > elements[e]["threshold"]) {
                if (value < 1) {
                    value = Math.round(value * 100) + "%";
                    elements[e]["string"] = elements[e]["percentString"];
                } else {
                    value = Math.round(value - 0.3);
                    if (value == 1) {
                        elements[e]["string"] = elements[e]["string"].replace("WORD", elements[e]["singularWord"]);
                    } else {
                        elements[e]["string"] = elements[e]["string"].replace("WORD", elements[e]["pluralWord"]);
                    }
                    document.getElementById("learn").href = elements[e]["sourceUrl"]
                    if (elements[e]["donate"]) {
                        document.getElementById("learn").innerHTML = "Learn More + Donate";
                    } else {
                        document.getElementById("learn").innerHTML = "Learn More";
                    }
                }
                elements[e]["value"] = value;
                addItems(elements);
            } else {
                if (backward != null) {
                    goBack("one");
                } else {
                    if (++index >= keys.length) {
                        index = 0;
                    }
                    calculateMoney();
                }

            }
        }

        function goBack(param) {
            if (param == null) {
                index -= 2;
            } else {
                index -= 1;
            }
            if (index == -2) {
                index = keys.length - 2;
            } else if (index == -1) {
                index = keys.length - 1;
            }
            calculateMoney(true);
        }

        function addItems() {
            document.getElementById("card").style.backgroundColor = randomColor(150);
            document.getElementById("body").style.backgroundColor = randomColor(220);
            //document.getElementById("text-header").style.backgroundColor = randomColor(200);
            key = keys[index];
            var e = elements[key];
            document.getElementById("description").style.display = "block";
            var description = formatDescription(e);
            document.getElementById("description").innerHTML = description;
            document.getElementById("element-image").src = e["src"];
            if (++index >= keys.length) {
                index = 0;
            }
        }

        function randomColor(hue) {
            var range = 255 - hue;
            return "rgb(" + (Math.random() * range + hue) + "," + (Math.random() * range + hue) + "," + (Math.random() * range + hue) + ")";
        }

        function formatDescription(e) {
            var str;
            console.log(e);
            if (e["value"] < 1) {
                str = e["percentString"];
            } else {
                str = e["string"];
            }
            return str.replace("VAR", e["value"]);
        }
    </script>
</head>

<body onload="parseUrl()" id="body">
    <div class="title-container section" id="text-header">
        <h1 class="title title-font">Instead of buying <span id="product"></span> for $<span id="price"></span>, you
            could:
        </h1>
    </div>

    <div class="card" id="card">
        <div class="img-container">
            <img id="element-image" class="item-img">
        </div>
        <div class="text-container">
            <p class="description title-font">
                <span style="display:none" id="description">Hm, looks like we couldn't find anything.</span>
            </p>
        </div>

        <div class="link-container title-font">
            <a id="learn" class="card-link" target="_blank">Learn More + Donate</a>
        </div>

        <!--<div class="share-container">
            <div class="share-wrapper">
                <button class="social facebook-btn title-font">
                    <!--<img src="images/facebook.png" class="icon">-->
        <!--SHARE
                </button>
                <button class="social twitter-btn title-font">
                    <!--<img src="images/twitter.png" class="icon">-->
        <!--TWEET
                </button>
            </div>
        </div>-->
    </div>

    <img src="images/left.png" class="next left" onclick="goBack()">
    <img src="images/right.png" class="next" onclick="calculateMoney()">

    <div class="buttons">
        <button class="btn title-font" onclick="calculateMoney();">
            <span class="btn-emoji"></span> next <span class="btn-emoji btn-emoji-right"></span></button>
    </div>

    <div class="guilt-footer">
        <a href="index.html">
            <h3 class="title-font">restart</h3>
        </a>
    </div>

    <!-- <div class="section" id="section1">

            
            <span style="display:none" id="childrenFed"><span id="childrenFedValue"></span> children fed for a day (source: World Food Programme)</span>
            <span style="display:none" id="poundsOfTrash"><span id="poundsOfTrashValue"></span> pounds of ocean trash (source: 4Ocean)</span>
            <span style="display:none" id="laptopStand"><span id="laptopStandValue"></span> of a Mac laptop stand (source: Apple)</span>
            <span style="display:none" id="tesla"><span id="teslaValue"></span> of an electric Tesla Model 3 (source: Tesla)</span>
            <span style="display:none" id="remoteClinic"><span id="remoteClinicValue"></span> towards mobile health clinics in rural areas (Source: rescue.org)</span>
            <span style="display:none" id="rebuildClassroom"><span id="rebuildClassroomValue"></span> towards rebuilding war-stricken schools in 3rd world countries (source: rescue.org)</span>
            <span style="display:none" id="womensTraining"><span id="womensTrainingValue"></span> towards helping one woman learn self-sustaning business and entrepreneurship. (source: rescue.org)</span>
            <span style="display:none" id="cleanWater"><span id="cleanWaterValue"></span> towards clean water systems (source: rescue.org)</span>
        </div>-->
</body>

</html>